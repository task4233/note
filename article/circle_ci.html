<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CircleCIを用いたVuePressの自動ビルド+デプロイ | Note</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/imgs/icons/icon.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="shortcut icon" href="/imgs/icons/favicon.ico">
    <meta name="description" content="VuePressの自動ビルド+デプロイ">
    <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/assets/css/0.styles.e16f9711.css" as="style"><link rel="preload" href="/assets/js/app.394da2b2.js" as="script"><link rel="preload" href="/assets/js/2.b8499f1b.js" as="script"><link rel="preload" href="/assets/js/49.68995984.js" as="script"><link rel="preload" href="/assets/js/3.31e57b96.js" as="script"><link rel="prefetch" href="/assets/js/10.abcd0870.js"><link rel="prefetch" href="/assets/js/11.9f9aca41.js"><link rel="prefetch" href="/assets/js/12.99309fa6.js"><link rel="prefetch" href="/assets/js/13.ecfb80d6.js"><link rel="prefetch" href="/assets/js/14.f02a189f.js"><link rel="prefetch" href="/assets/js/15.5fd33358.js"><link rel="prefetch" href="/assets/js/16.8166e7a5.js"><link rel="prefetch" href="/assets/js/17.7b8b1cf5.js"><link rel="prefetch" href="/assets/js/18.5ea8b8bc.js"><link rel="prefetch" href="/assets/js/19.8bf6995a.js"><link rel="prefetch" href="/assets/js/20.0e296bc9.js"><link rel="prefetch" href="/assets/js/21.7a34b1b3.js"><link rel="prefetch" href="/assets/js/22.f74adf24.js"><link rel="prefetch" href="/assets/js/23.b94c0779.js"><link rel="prefetch" href="/assets/js/24.9efdd680.js"><link rel="prefetch" href="/assets/js/25.567790cb.js"><link rel="prefetch" href="/assets/js/26.edf3d886.js"><link rel="prefetch" href="/assets/js/27.28b6e9d6.js"><link rel="prefetch" href="/assets/js/28.397df9d9.js"><link rel="prefetch" href="/assets/js/29.4ae66d78.js"><link rel="prefetch" href="/assets/js/30.7e9ea8d9.js"><link rel="prefetch" href="/assets/js/31.c12ab2ca.js"><link rel="prefetch" href="/assets/js/32.477c0f3c.js"><link rel="prefetch" href="/assets/js/33.795b923c.js"><link rel="prefetch" href="/assets/js/34.b5d85bac.js"><link rel="prefetch" href="/assets/js/35.e14804bb.js"><link rel="prefetch" href="/assets/js/36.3a10fc14.js"><link rel="prefetch" href="/assets/js/37.540b03c2.js"><link rel="prefetch" href="/assets/js/38.9f371b2a.js"><link rel="prefetch" href="/assets/js/39.6724312e.js"><link rel="prefetch" href="/assets/js/4.00d6b6ad.js"><link rel="prefetch" href="/assets/js/40.ca3f59db.js"><link rel="prefetch" href="/assets/js/41.68c40b87.js"><link rel="prefetch" href="/assets/js/42.caea1831.js"><link rel="prefetch" href="/assets/js/43.5e87b3c2.js"><link rel="prefetch" href="/assets/js/44.78668bc3.js"><link rel="prefetch" href="/assets/js/45.ce09b564.js"><link rel="prefetch" href="/assets/js/46.8ae11a8d.js"><link rel="prefetch" href="/assets/js/47.cf076206.js"><link rel="prefetch" href="/assets/js/48.c85f5a87.js"><link rel="prefetch" href="/assets/js/5.1d72ad79.js"><link rel="prefetch" href="/assets/js/50.7f871e67.js"><link rel="prefetch" href="/assets/js/51.f2bfb70d.js"><link rel="prefetch" href="/assets/js/52.44e05f1a.js"><link rel="prefetch" href="/assets/js/53.752dfac0.js"><link rel="prefetch" href="/assets/js/54.e26ac048.js"><link rel="prefetch" href="/assets/js/55.687a5957.js"><link rel="prefetch" href="/assets/js/56.a4ca43fe.js"><link rel="prefetch" href="/assets/js/57.36aa5d30.js"><link rel="prefetch" href="/assets/js/58.73d7344f.js"><link rel="prefetch" href="/assets/js/59.348a3966.js"><link rel="prefetch" href="/assets/js/6.6ec95fbb.js"><link rel="prefetch" href="/assets/js/60.1ec327af.js"><link rel="prefetch" href="/assets/js/61.be151036.js"><link rel="prefetch" href="/assets/js/62.9843ae0f.js"><link rel="prefetch" href="/assets/js/63.875ad110.js"><link rel="prefetch" href="/assets/js/64.fd70f135.js"><link rel="prefetch" href="/assets/js/65.8e070865.js"><link rel="prefetch" href="/assets/js/66.5a7f9c73.js"><link rel="prefetch" href="/assets/js/67.e66744bf.js"><link rel="prefetch" href="/assets/js/68.3aa5e297.js"><link rel="prefetch" href="/assets/js/69.1c2d936d.js"><link rel="prefetch" href="/assets/js/7.0b1e9a07.js"><link rel="prefetch" href="/assets/js/70.eb954a0b.js"><link rel="prefetch" href="/assets/js/71.309d716a.js"><link rel="prefetch" href="/assets/js/72.5ce05afc.js"><link rel="prefetch" href="/assets/js/73.f534554b.js"><link rel="prefetch" href="/assets/js/74.472f9854.js"><link rel="prefetch" href="/assets/js/75.2e5c0ae5.js"><link rel="prefetch" href="/assets/js/76.a23695d0.js"><link rel="prefetch" href="/assets/js/77.e49dc838.js"><link rel="prefetch" href="/assets/js/78.92c62c5c.js"><link rel="prefetch" href="/assets/js/79.0c989041.js"><link rel="prefetch" href="/assets/js/8.7d241289.js"><link rel="prefetch" href="/assets/js/80.bb13499d.js"><link rel="prefetch" href="/assets/js/81.af8622f5.js"><link rel="prefetch" href="/assets/js/82.c09661cb.js"><link rel="prefetch" href="/assets/js/83.898f1a42.js"><link rel="prefetch" href="/assets/js/84.498873b0.js"><link rel="prefetch" href="/assets/js/85.741aee96.js"><link rel="prefetch" href="/assets/js/86.91836f2b.js"><link rel="prefetch" href="/assets/js/87.7b94e377.js"><link rel="prefetch" href="/assets/js/88.a3490bcb.js"><link rel="prefetch" href="/assets/js/9.84210955.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e16f9711.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/#links" class="nav-link">Links</a></div><div class="nav-item"><a href="/tags/" class="nav-link">Articles</a></div><div class="nav-item"><a href="/chukapi_fun_art.html" class="nav-link">Chukapi-Fun-Art</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/#links" class="nav-link">Links</a></div><div class="nav-item"><a href="/tags/" class="nav-link">Articles</a></div><div class="nav-item"><a href="/chukapi_fun_art.html" class="nav-link">Chukapi-Fun-Art</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>CircleCIを用いたVuePressの自動ビルド+デプロイ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/article/circle_ci.html#初期設定" class="sidebar-link">初期設定</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/circle_ci.html#_1-登録" class="sidebar-link">1. 登録</a></li><li class="sidebar-sub-header"><a href="/article/circle_ci.html#_2-ssh-keyの設定" class="sidebar-link">2.ssh-keyの設定</a></li><li class="sidebar-sub-header"><a href="/article/circle_ci.html#_3-circleci-cliツールのインストール" class="sidebar-link">3.CircleCI CLIツールのインストール</a></li></ul></li><li><a href="/article/circle_ci.html#circleci-config-ymlファイルの作成" class="sidebar-link">.circleci/config.ymlファイルの作成</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/article/circle_ci.html#作成したファイルのvalidation" class="sidebar-link">作成したファイルのvalidation</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/article/circle_ci.html#_0-nodeのパッケージインストール" class="sidebar-link">0. nodeのパッケージインストール</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/article/circle_ci.html#_1-yarn-src-buildの実行" class="sidebar-link">1. $ yarn src:buildの実行</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/article/circle_ci.html#_2-gh-pagesブランチに配置" class="sidebar-link">2. gh-pagesブランチに配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/circle_ci.html#スクリプトの作成" class="sidebar-link">スクリプトの作成</a></li><li class="sidebar-sub-header"><a href="/article/circle_ci.html#スクリプトを実行するコマンドの追記" class="sidebar-link">スクリプトを実行するコマンドの追記</a></li><li class="sidebar-sub-header"><a href="/article/circle_ci.html#circleci-config-ymlへの追記" class="sidebar-link">.circleci/config.ymlへの追記</a></li><li class="sidebar-sub-header"><a href="/article/circle_ci.html#書いた-circleci-config-ymlのvalidate" class="sidebar-link">書いた.circleci/config.ymlのvalidate</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="circleciを用いたvuepressの自動ビルド-デプロイ"><a href="#circleciを用いたvuepressの自動ビルド-デプロイ" class="header-anchor">#</a> CircleCIを用いたVuePressの自動ビルド+デプロイ</h1> <ul><li>タイトルのとおりです</li></ul> <h1 id="はじめに"><a href="#はじめに" class="header-anchor">#</a> はじめに</h1> <ul><li><p>VuePressは毎回buildする必要があるので面倒</p></li> <li><p>誰かがCIを使って自動デプロイとか言ってたな</p></li> <li><p>やってみるか</p></li> <li><p>や　り　ま　し　た</p></li></ul> <h1 id="circleciのセッティング"><a href="#circleciのセッティング" class="header-anchor">#</a> CircleCIのセッティング</h1> <ul><li>インストール等のセッティングを行います</li> <li>本題を見たい方は, 本題まで飛んでください</li></ul> <h2 id="初期設定"><a href="#初期設定" class="header-anchor">#</a> 初期設定</h2> <ul><li>大抵はつぎの公式ページに書かれています</li> <li>公式がちゃんとしているので書くことはあまりないですが, 流れだけざっとさらっていきます</li> <li>部分的に翻訳されているようです
<ul><li><a href="https://circleci.com/docs/ja/2.0/" target="_blank" rel="noopener noreferrer">Welcome to CircleCI Documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul> <h3 id="_1-登録"><a href="#_1-登録" class="header-anchor">#</a> 1. 登録</h3> <ul><li>つぎの公式記事の通りに進めれば問題ないはずです
<ul><li><a href="https://circleci.com/docs/ja/2.0/first-steps/#section=getting-started" target="_blank" rel="noopener noreferrer">CircleCIを始める<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul> <h3 id="_2-ssh-keyの設定"><a href="#_2-ssh-keyの設定" class="header-anchor">#</a> 2.ssh-keyの設定</h3> <ul><li>つぎの記事の通りに進めれば問題ないはずです
<ul><li><a href="https://qiita.com/boushi-bird@github/items/6b6eb1d1ed6f6d3341e4" target="_blank" rel="noopener noreferrer">Circle CI で Github に write access 可能な Deploy key を設定する<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://circleci.com/docs/ja/2.0/add-ssh-key/" target="_blank" rel="noopener noreferrer">CircleCI に SSH 鍵を登録する<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul> <div class="custom-block danger"><p class="custom-block-title">注意</p> <ul><li><strong>パスフレーズ付きのrsa鍵だとCircleCI側から認められないので注意してください</strong> <ul><li>これに騙されました</li></ul></li></ul></div> <h3 id="_3-circleci-cliツールのインストール"><a href="#_3-circleci-cliツールのインストール" class="header-anchor">#</a> 3.CircleCI CLIツールのインストール</h3> <ul><li><p>つぎの公式記事の通りに進めれば問題ないはずです</p> <ul><li><a href="https://circleci.com/docs/ja/2.0/local-cli/#installation" target="_blank" rel="noopener noreferrer">Installation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><p>CircleCI CLIツールでは, つぎのようなことができます</p> <ul><li>CI config(.circleci/config.yml)のデバッグとvalidation</li> <li>ローカルでのジョブ実行</li> <li>CircleCIのAPI利用</li> <li>CircleCI Orbs関連</li></ul></li> <li><p>インストールするコマンドだけ残しておきます</p></li> <li><p>MacとLinuxでは次のコマンドでインストールできるようです</p></li> <li><p>念の為アップデートまで含めたコマンドを書いておきます</p></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># install</span>
$ <span class="token function">curl</span> -fLSs https://circle.ci/cli <span class="token operator">|</span> <span class="token function">bash</span> 
<span class="token comment"># update</span>
$ circleci update
$ circleci switch
</code></pre></div><ul><li>インストールしている際に, <code>permission denied</code>が発生することがあるようです</li> <li>その時はつぎのようにコマンドを変更して対処してください</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code></code></pre></div><h2 id="circleci-config-ymlファイルの作成"><a href="#circleci-config-ymlファイルの作成" class="header-anchor">#</a> .circleci/config.ymlファイルの作成</h2> <ul><li>CircleCIの動作を定義するymlファイルを作成します</li> <li>記法についてはつぎの記事の通りに書けば問題ないはずです
<ul><li><a href="https://circleci.com/docs/2.0/configuration-reference/" target="_blank" rel="noopener noreferrer">Configuring CircleCI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul> <div class="custom-block danger"><p class="custom-block-title">注意</p> <ul><li><strong>インデントでerrorになることが多いです</strong></li> <li>注意しましょう
<ul><li>これで小一時間溶かしました</li></ul></li></ul></div> <ul><li>雛形は, 先ほどの記事の下の方にあります
<ul><li><a href="https://circleci.com/docs/2.0/configuration-reference/#full-example" target="_blank" rel="noopener noreferrer">Full Example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul> <h2 id="作成したファイルのvalidation"><a href="#作成したファイルのvalidation" class="header-anchor">#</a> 作成したファイルのvalidation</h2> <ul><li><p>つぎの公式記事の通りに進めれば問題ないはずです</p> <ul><li><a href="https://circleci.com/docs/2.0/local-cli/#validate-a-circleci-config" target="_blank" rel="noopener noreferrer">Validate A CircleCI Config<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><p>次のコマンドでvalidationができます</p> <ul><li>ただし, config.ymlは<code>.circleci/config.yml</code>に配置しましょう</li></ul></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ circleci config validate
<span class="token comment"># Config file at .circleci/config.yml is valid</span>
</code></pre></div><h1 id="本題"><a href="#本題" class="header-anchor">#</a> 本題</h1> <ul><li><p>タイトルで触れている自動ビルド + デプロイの部分に入っていきます</p></li> <li><p>全体の流れはつぎのとおりです</p></li> <li><p>四角で囲まれた部分をCircleCIを用いて構築していきます</p></li> <li><p>CircleCIにやってもらいたいことは, つぎの2つです</p> <ul><li><code>$ yarn src:build</code>の実行</li> <li>実行後にできた<code>./docs</code>以下のファイルを<code>gh-pages</code>ブランチに配置</li></ul></li> <li><p>しかし, いずれもnodeのパッケージをインストールしておく必要があります</p></li> <li><p>その処理を書いてから, 先ほどの2つの処理を加えていきます</p></li></ul> <h2 id="_0-nodeのパッケージインストール"><a href="#_0-nodeのパッケージインストール" class="header-anchor">#</a> 0. nodeのパッケージインストール</h2> <ul><li>nodeのパッケージをインストールするためには, つぎのように書きます</li> <li><code>restore_cache</code>と<code>save_cache</code>でnode_moduleのキャッシュを残しておくものです</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code>// .circleci/config.yml
<span class="token key atrule">+ version</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token key atrule">+ jobs</span><span class="token punctuation">:</span>
<span class="token key atrule">+   build</span><span class="token punctuation">:</span>
<span class="token key atrule">+     docker</span><span class="token punctuation">:</span>
<span class="token key atrule">+       - image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">8.12</span>
<span class="token key atrule">+     working_directory</span><span class="token punctuation">:</span> ~/task4233/note
<span class="token key atrule">+     steps</span><span class="token punctuation">:</span>
+       <span class="token punctuation">-</span> checkout
<span class="token key atrule">+       - restore_cache</span><span class="token punctuation">:</span>
<span class="token key atrule">+           key</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token key atrule">+       - run</span><span class="token punctuation">:</span>
<span class="token key atrule">+           name</span><span class="token punctuation">:</span> Install dependencies
<span class="token key atrule">+           command</span><span class="token punctuation">:</span> yarn
<span class="token key atrule">+       - save_cache</span><span class="token punctuation">:</span>
<span class="token key atrule">+           key</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token key atrule">+           paths</span><span class="token punctuation">:</span>
+             <span class="token punctuation">-</span> ./node_modules
+
<span class="token key atrule">+ workflows</span><span class="token punctuation">:</span>
<span class="token key atrule">+   version</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token key atrule">+   build-deploy</span><span class="token punctuation">:</span>
<span class="token key atrule">+     jobs</span><span class="token punctuation">:</span>
+       <span class="token punctuation">-</span> build
</code></pre></div><h2 id="_1-yarn-src-buildの実行"><a href="#_1-yarn-src-buildの実行" class="header-anchor">#</a> 1. <code>$ yarn src:build</code>の実行</h2> <ul><li>これは簡単です</li> <li>つぎのように, <code>.circleci/config.yml</code>に追記します</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code>// .circleci/config.yml
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">docker</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">8.12</span>
    <span class="token key atrule">working_directory</span><span class="token punctuation">:</span> ~/task4233/note
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> checkout
      <span class="token punctuation">-</span> <span class="token key atrule">restore_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
          <span class="token key atrule">command</span><span class="token punctuation">:</span> yarn
      <span class="token punctuation">-</span> <span class="token key atrule">save_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">paths</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ./node_modules
 <span class="token key atrule">+     - run</span><span class="token punctuation">:</span>
 <span class="token key atrule">+         name</span><span class="token punctuation">:</span> Build
 <span class="token key atrule">+         command</span><span class="token punctuation">:</span> yarn src<span class="token punctuation">:</span>build

<span class="token key atrule">workflows</span><span class="token punctuation">:</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">build-deploy</span><span class="token punctuation">:</span>
    <span class="token key atrule">jobs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> build
</code></pre></div><h2 id="_2-gh-pagesブランチに配置"><a href="#_2-gh-pagesブランチに配置" class="header-anchor">#</a> 2. <code>gh-pages</code>ブランチに配置</h2> <ul><li>そのようなスクリプトは存在していないので, スクリプトを作成して<code>.circleci/config.yml</code>に追記します</li></ul> <h3 id="スクリプトの作成"><a href="#スクリプトの作成" class="header-anchor">#</a> スクリプトの作成</h3> <ul><li><code>gh-pages</code>ブランチに<code>./docs</code>以下のファイルを配置するために, nodejsの<code>gh-pages</code>パッケージを利用します</li> <li>つぎのように新たに<code>deploy.js</code>を書きます</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// deploy.js</span>
<span class="token operator">+</span> <span class="token keyword">var</span> ghpages <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gh-pages&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span> ghpages<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">&quot;./docs&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>     user<span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>         name<span class="token operator">:</span> <span class="token string">&quot;{YOUR_NAME}&quot;</span><span class="token punctuation">,</span>
<span class="token operator">+</span>         email<span class="token operator">:</span> <span class="token string">&quot;{YOUR_EMAIL}&quot;</span>
<span class="token operator">+</span>     <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">+</span>     message<span class="token operator">:</span> <span class="token string">&quot;Auto build and deploy [ci skip]&quot;</span>
<span class="token operator">+</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>         process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Successfully Delployed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>     <span class="token punctuation">}</span>
<span class="token operator">+</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>6,7行目は自身のものに変更してください</li> <li>9行目でわざわざmessageを記載しているのは, コミットメッセージに<code>[ci skip]</code>を付与することで<code>gh-pages</code>ブランチでCircleCIを動作させないためです
<ul><li><code>gh-pages</code>ブランチは公開用ブランチなので, <code>gh-pages</code>ブランチではCircleCIを動作させません</li></ul></li></ul> <h3 id="スクリプトを実行するコマンドの追記"><a href="#スクリプトを実行するコマンドの追記" class="header-anchor">#</a> スクリプトを実行するコマンドの追記</h3> <ul><li>このjsファイルを実行させるためのコマンドを<code>package.json</code>に追記します</li> <li>他の部分は私の設定なので, 自身の<code>package.json</code>に7行目の内容のみ追記してください</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pg&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>       <span class="token string">&quot;deploy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./deploy.js&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;src:dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vuepress dev src --port 3030&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;src:build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rm -rf ./docs &amp;&amp; vuepress build src&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;repository&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git+https://github.com/task4233/note.git&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;task4233&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;markdown-it&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.4.2&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;markdown-it-katex&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.3&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;markdown-it-task-lists&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.1.1&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;vuepress&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.14.8&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;gh-pages&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.1&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="circleci-config-ymlへの追記"><a href="#circleci-config-ymlへの追記" class="header-anchor">#</a> .circleci/config.ymlへの追記</h3> <ul><li>コマンドが完成したので, <code>.circleci/config.yml</code>に追記します</li> <li>つぎのように追記します</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">docker</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">8.12</span>
    <span class="token key atrule">working_directory</span><span class="token punctuation">:</span> ~/task4233/note
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> checkout
      <span class="token punctuation">-</span> <span class="token key atrule">restore_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
          <span class="token key atrule">command</span><span class="token punctuation">:</span> yarn
      <span class="token punctuation">-</span> <span class="token key atrule">save_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">paths</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ./node_modules
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> Build
          <span class="token key atrule">command</span><span class="token punctuation">:</span> yarn src<span class="token punctuation">:</span>build
 <span class="token key atrule">+    - run</span><span class="token punctuation">:</span>
 <span class="token key atrule">+        name</span><span class="token punctuation">:</span> Deploy
 <span class="token key atrule">+        command</span><span class="token punctuation">:</span> yarn deploy

<span class="token key atrule">workflows</span><span class="token punctuation">:</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">build-deploy</span><span class="token punctuation">:</span>
    <span class="token key atrule">jobs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> build
</code></pre></div><h3 id="書いた-circleci-config-ymlのvalidate"><a href="#書いた-circleci-config-ymlのvalidate" class="header-anchor">#</a> 書いた.circleci/config.ymlのvalidate</h3> <ul><li>githubにpushしてから<code>config.yml</code>のせいでエラーがでると悲しくなるので, ローカルでvalidateします</li> <li>つぎのコマンドでvalidateできます</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ circleci config validate -c <span class="token punctuation">{</span>config.ymlまでのファイルパス<span class="token punctuation">}</span>
<span class="token comment"># circleci config validate -c ./.circleci/config.yml</span>
<span class="token comment"># Config file at ./.circleci/config.yml is valid.</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">10ヶ月前</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.394da2b2.js" defer></script><script src="/assets/js/2.b8499f1b.js" defer></script><script src="/assets/js/49.68995984.js" defer></script><script src="/assets/js/3.31e57b96.js" defer></script>
  </body>
</html>
