(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{339:function(t,a,n){"use strict";n.r(a);var s=n(12),r=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"gopher塾-1-testing-参加ログ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gopher塾-1-testing-参加ログ"}},[t._v("#")]),t._v(" Gopher塾 #1 - Testing 参加ログ")]),t._v(" "),a("h2",{attrs:{id:"はじめに"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#はじめに"}},[t._v("#")]),t._v(" はじめに")]),t._v(" "),a("p",[t._v("2022/11/3(木)に開催された"),a("strong",[a("strong",[t._v("Gopher塾 #1 - Testing - DAY2")])]),t._v("に参加しました。このイベントはGoのテストについて講義形式で学ぶイベントです。扱われた内容は"),a("a",{attrs:{href:"https://tenntenn.connpass.com/event/262106/#:~:text=%E3%81%94%E8%A6%A7%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84%E3%80%82-,%E5%86%85%E5%AE%B9,-%E4%BB%A5%E4%B8%8B%E3%81%AE%E5%86%85%E5%AE%B9",target:"_blank",rel:"noopener noreferrer"}},[t._v("connpassのページ"),a("OutboundLink")],1),t._v("をご覧ください。")]),t._v(" "),a("p",[t._v("本エントリでは、私が新たに知った/気づいたことを共有します。")]),t._v(" "),a("h3",{attrs:{id:"テストのカバレッジは何-程度にしておくと良いか"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#テストのカバレッジは何-程度にしておくと良いか"}},[t._v("#")]),t._v(" テストのカバレッジは何%程度にしておくと良いか")]),t._v(" "),a("p",[t._v("前提として、"),a("strong",[t._v("カバレッジはあくまで参考にする数値")]),t._v("です。そのため、カバレッジだけに着目して数字を追いかけることに意味はなさそうです。")]),t._v(" "),a("p",[t._v("その上で、カバレッジを指標の1つとする場合でも、基準はプロジェクトに依存するとのことです。少なくとも60%は欲しく、80%程度あると望ましいとの話でした。テストが難しかったり不要だったりするロジックが存在するため、100%のカバレッジを目指す必要はありません。")]),t._v(" "),a("h3",{attrs:{id:"errorとfatalの使い分け"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#errorとfatalの使い分け"}},[t._v("#")]),t._v(" ErrorとFatalの使い分け")]),t._v(" "),a("p",[a("strong",[t._v("後続の処理が実行不能になる場合はFatal、そうでない場合はErrorを使うと良い")]),t._v("とのことです。ただし、Fatalを実行すると内部的に "),a("code",[t._v("runtime.Goexit()")]),t._v(" が実行されてしまうことに注意してください。一応、Error+即時returnを利用することもできますが、return後に後続の処理が実行される場合は代替にならないためクロージャ外でFatalを利用することが好ましいです。")]),t._v(" "),a("h3",{attrs:{id:"go-testの-vオプション"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#go-testの-vオプション"}},[t._v("#")]),t._v(" $ go testの-vオプション")]),t._v(" "),a("p",[a("strong",[a("code",[t._v("-v")]),t._v(" オプションを使うのはローカルでのデバッグにとどめ、CIでは理由がなければ付与しない方が良いのでは")]),t._v("ないか、とのことです。 理由としては、テスト失敗時の原因が見づらいこと、出力が増える分処理が遅くなることが挙げられます。")]),t._v(" "),a("h3",{attrs:{id:"カバレッジがどう計算されているか"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#カバレッジがどう計算されているか"}},[t._v("#")]),t._v(" カバレッジがどう計算されているか")]),t._v(" "),a("p",[a("code",[t._v("$ go test -cover")]),t._v(" の実行時に、GoのCLIが以下のような計測用のコードを内部的に差し込みます。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ go tool cover -mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("set a.go\n//line a.go:1\npackage testbuild\n\nfunc "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("F")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("GoCover.Count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" // この行が実行された場合、Count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("が1になる\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("GoCover.Count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tprintln"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("この差し込まれたコードによって集計された情報をもとに、カバレッジが計算されています。")]),t._v(" "),a("p",[t._v("ちなみに、 "),a("code",[t._v("$ go test")]),t._v(" のカバレッジで利用される指標はC0(命令網羅)です。他の指標には、C1(分岐網羅)、C2(条件網羅)があります。")]),t._v(" "),a("p",[t._v("ref: "),a("strong",[a("strong",[a("a",{attrs:{href:"https://tech.naturalmindo.com/notwork_coverage/",target:"_blank",rel:"noopener noreferrer"}},[t._v("いつも忘れてしまうC0/C1/C2カバレッジまとめ"),a("OutboundLink")],1)])])]),t._v(" "),a("h3",{attrs:{id:"gp-go-playgroundのcliツール"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gp-go-playgroundのcliツール"}},[t._v("#")]),t._v(" gp: Go PlaygroundのCLIツール")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/tenntenn/goplayground",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHubで公開されている"),a("OutboundLink")],1),t._v("Go PlaygroundのCLIツールです。ローカルのコードを共有したい時に便利です。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" installation\n$ go "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" github.com/tenntenn/goplayground/cmd/gp@latest\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" generate a url of a playground\n$ gp share main_test.go\nhttps://go.dev/play/p/zVM3DkjZj6s\n")])])]),a("h3",{attrs:{id:"ループ変数にtt-ttが必要という話"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ループ変数にtt-ttが必要という話"}},[t._v("#")]),t._v(" ループ変数にtt := ttが必要という話")]),t._v(" "),a("p",[t._v("Goには、以下のようなループ変数のイテレーションで、 "),a("code",[t._v("tt := tt")]),t._v(" のようにコピーを生成しないと、1つの変数のみが参照されてしまうという問題があります。")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"math"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testing"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddOne")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("num "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" num "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("TestAddOne")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("testing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Parallel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\tcases "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\targ  "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("\n\t\twant "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"invalid case: 0=>0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\targ"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\twant"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5=>6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\targ"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\twant"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-1=>0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\targ"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\twant"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MaxInt->MinInt"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// lol")]),t._v("\n\t\t\targ"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MaxInt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\twant"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MinInt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tt "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("range")]),t._v(" cases "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// NOTE: ここでループ変数ttのコピーをしないと、次に来るt.Run()内の関数では同じ変数しか参照されない")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// tt := tt")]),t._v("\n\n\t\tt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("testing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Parallel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\tgot "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddOne")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" got "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" tt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("want "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\tt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Fatalf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"failed addOne: want: %d, got: %d"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("want"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" got"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("ref: "),a("a",{attrs:{href:"https://go.dev/play/p/aThJGJu46K2",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://go.dev/play/p/aThJGJu46K2"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("熟練者でもミスすることがあるため、イテレーションごとに変数を生成する案がGoコントリビュータのRuss Cox(rsc)から提案されています。")]),t._v(" "),a("p",[t._v("ref: "),a("strong",[a("a",{attrs:{href:"https://github.com/golang/go/discussions/56010",target:"_blank",rel:"noopener noreferrer"}},[t._v("redefining for loop variable semantics"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"testingパッケージの便利メソッド"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#testingパッケージの便利メソッド"}},[t._v("#")]),t._v(" testingパッケージの便利メソッド")]),t._v(" "),a("p",[t._v("初めて知ったのは "),a("a",{attrs:{href:"https://pkg.go.dev/testing#B.Cleanup",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cleanup"),a("OutboundLink")],1),t._v(" と "),a("a",{attrs:{href:"https://pkg.go.dev/testing#B.TempDir",target:"_blank",rel:"noopener noreferrer"}},[t._v("TempDir"),a("OutboundLink")],1),t._v(" の2つです。")]),t._v(" "),a("p",[t._v("前者は、引数で渡された関数をテスト終了時に実行するメソッドです。 "),a("code",[t._v("defer")]),t._v(" で終了処理を実装するとテスト関数終了時に実行されるため、 "),a("code",[t._v("t.Parallel()")]),t._v(" によって順序性が保証されないテストとアンマッチである場合があります。そこで利用できるのが、この "),a("a",{attrs:{href:"https://pkg.go.dev/testing#B.Cleanup",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cleanup"),a("OutboundLink")],1),t._v(" メソッドです。")]),t._v(" "),a("p",[t._v("後者は、テスト時に作成された一時ディレクトリのパスを返すメソッドです。ここで生成された一時ディレクトリは、"),a("a",{attrs:{href:"https://pkg.go.dev/testing#B.Cleanup",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cleanup"),a("OutboundLink")],1),t._v(" 実行時に自動的に削除されます。")]),t._v(" "),a("h3",{attrs:{id:"txtar-複数のファイルをまとめて扱うファイル形式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#txtar-複数のファイルをまとめて扱うファイル形式"}},[t._v("#")]),t._v(" txtar: 複数のファイルをまとめて扱うファイル形式")]),t._v(" "),a("p",[a("code",[t._v("-- ファイルパス --")]),t._v(" を区切り文字として、1つのファイルに複数のファイルのデータを入れることで、まとめて扱うファイル形式です。Go Playgroundでも利用が可能です。")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myprinter/myprinter"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tmyprinter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hoge"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("go")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mod "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\nmodule myprinter\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" myprinter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("myprinter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("go")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" myprinter\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arg any"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[myprinter]: %v"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("ref: "),a("a",{attrs:{href:"https://go.dev/play/p/Hglypeavo5Q",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://go.dev/play/p/Hglypeavo5Q"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"golden-file-test"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#golden-file-test"}},[t._v("#")]),t._v(" Golden File Test")]),t._v(" "),a("p",[t._v("期待するデータを、文字列ではなくファイルで用意しておくテスト形式のことです。”Golden File Test” というテスト名は、用意されたファイルを Golden File と呼ぶことに由来するものです。")]),t._v(" "),a("h2",{attrs:{id:"おわりに"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#おわりに"}},[t._v("#")]),t._v(" おわりに")]),t._v(" "),a("p",[t._v("Goのテストにおける基礎に始まり、発展的な内容まで扱ってくださったので満足しています。")]),t._v(" "),a("p",[t._v("特に、Goのカバレッジ計算の実装方法の仕組みが一般的なFuzzerのそれと似ていたため、少しの感動がありました。と言うのも、Fuzzerは効率的に入力データを生成する必要があるために機械語やアセンブリレベルでコードをインサートするんですよね。発想がほとんど同じなのでなるほどなという気持ちになりました。")]),t._v(" "),a("p",[t._v("また、実装に関しての予想ですが、ソースコードのASTを構築してから各行にカウントするコードを挿入していそうだなと思いました。Goはastパッケージが優秀なので、ソースコードを入れるだけでシュッと解析してくれますし。実際に、私が以前開発した"),a("a",{attrs:{href:"https://github.com/task4233/dl",target:"_blank",rel:"noopener noreferrer"}},[t._v("コミットされないロガーであるdelog"),a("OutboundLink")],1),t._v("も、astパッケージの恩恵をかなり受けていました。")]),t._v(" "),a("p",[t._v("余談はさておき、"),a("a",{attrs:{href:"https://tenntenn.connpass.com/event/265342/",target:"_blank",rel:"noopener noreferrer"}},[t._v("本イベントは11/23にも開催される"),a("OutboundLink")],1),t._v("ようです。Goのテストに興味がある方は参加してみてはいかがでしょうか。")])])}),[],!1,null,null,null);a.default=r.exports}}]);